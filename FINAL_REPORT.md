# κ²μ„ μ„λ²„ μµμΆ… μƒνƒ λ³΄κ³ μ„

**μ‘μ„±μΌ**: 2025-12-25  
**λ©μ **: ν•™κµ μ¶•μ (4μ‹κ°„, λ…ΈνΈλ¶ 7λ€, 2λ¶„ κ²μ„) ν™κ²½μ—μ„ μ„λ²„ μ•μ •μ„± λ³΄μ¥  
**λ°°ν¬ ν”λ«νΌ**: Render.com (λ¬΄λ£ ν”λ)

---

## β… μ™„λ£λ μµμ ν™” μ‘μ—…

### 1. HTTP 500 μ—λ¬ μ κ±°
- **λ³€κ²½μ‚¬ν•­**: λ¨λ“  APIμ—μ„ μ—λ¬ λ°μƒ μ‹μ—λ„ HTTP 200 λ°ν™
- **μ‘λ‹µ ν•μ‹**: `{ success: true/false, data: ..., message: ... }`
- **μ„μΉ**: `server/routes.ts` (λ¨λ“  μ—”λ“ν¬μΈνΈ)
- **ν¨κ³Ό**: Render λ¬΄λ£ ν”λμ—μ„ HTTP 500μΌλ΅ μΈν• μ„λ²„ μ¬μ‹μ‘ λ°©μ§€

### 2. DELETE /api/rankings λ³΄νΈ κ°•ν™”
- **λ³€κ²½μ‚¬ν•­**: ν™κ²½ λ³€μ `CLEAR_RANKINGS_KEY`μ™€ query key μΌμΉ ν™•μΈ
- **κΈ°λ³Έκ°’**: `"default-secret-key-change-in-production"`
- **μ„μΉ**: `server/routes.ts` (DELETE μ—”λ“ν¬μΈνΈ)
- **ν¨κ³Ό**: μ‹¤μ λλ” μ™Έλ¶€ μ ‘κ·ΌμΌλ΅ μΈν• λ­ν‚Ή μ΄κΈ°ν™” λ°©μ§€

### 3. Rate Limiting μµμ ν™”
- **λ³€κ²½μ‚¬ν•­**: POST /api/rankings μ ν•μ„ 1000/λ¶„ β†’ 30/λ¶„μΌλ΅ μ¶•μ†
- **κ·Όκ±°**: 
  - ν•™κµ μ¶•μ  ν™κ²½: 7λ€ λ…ΈνΈλ¶ Γ— 2λ¶„ κ²μ„ = μµλ€ λ¶„λ‹Ή 3.5ν
  - μ—¬μ μκ² 30ν/λ¶„ μ„¤μ • (μ•½ 8.5λ°° μ—¬μ )
  - Render λ¬΄λ£ ν”λ: κ³Όλ„ν• μ”μ²­ μ‹ μ„λ²„ μ¬μ‹μ‘ μ„ν— λ°©μ§€
- **μ„μΉ**: `server/routes.ts`
- **ν¨κ³Ό**: μ„λ²„ λ¶€ν• κ°μ†, μ•μ •μ„± ν–¥μƒ

### 4. createdAt μ§λ ¬ν™” μ•μ •μ„± κ°μ„ 
- **λ³€κ²½μ‚¬ν•­**: `Date` κ°μ²΄ β†’ `number` (timestamp)λ΅ λ³€κ²½
- **μ„μΉ**: 
  - `shared/schema.ts` (νƒ€μ… μ •μ)
  - `server/storage.ts` (μ €μ¥/λ΅λ“ λ΅μ§)
  - `client/src/pages/investment-game.tsx` (ν΄λΌμ΄μ–ΈνΈ μ²λ¦¬)
- **ν¨κ³Ό**: νμΌ μ €μ¥/λ΅λ“ μ‹ νƒ€μ… λ¶μΌμΉ μ„ν— μ κ±°, JSON μ§λ ¬ν™” μ•μ •μ„± ν–¥μƒ

### 5. μ„±λ¥ μµμ ν™”
- **λ³€κ²½μ‚¬ν•­**: 
  - `getRankings()`: λ­ν‚Ή μμ— λ”°λ¥Έ μ΅°κ±΄λ¶€ μ •λ ¬ μµμ ν™”
  - ν”„λ΅λ•μ… λ¨λ“μ—μ„ μƒμ„Έ λ΅κΉ… μµμ†ν™”
- **μ„μΉ**: `server/storage.ts`, `server/routes.ts`
- **ν¨κ³Ό**: λ¶ν•„μ”ν• μ—°μ‚° κ°μ†, λ΅κ·Έ I/O λ¶€ν• κ°μ†

### 6. μ—λ¬ ν•Έλ“¤λ§ κ°•ν™”
- **λ³€κ²½μ‚¬ν•­**: 
  - `resolveQueue` undefined μ²΄ν¬ μ¶”κ°€
  - `clearRankings()` νμΌ μ €μ¥ μ‹¤ν¨ μ‹μ—λ„ μ•μ „ν•κ² μ²λ¦¬
- **μ„μΉ**: `server/storage.ts`
- **ν¨κ³Ό**: μμ™Έ μƒν™©μ—μ„λ„ μ„λ²„ ν¬λμ‹ λ°©μ§€

---

## π”§ ν„μ¬ μ„λ²„ μ„¤μ •

### Rate Limiting
| μ—”λ“ν¬μΈνΈ | μ ν• | κ·Όκ±° |
|-----------|------|------|
| POST /api/rankings | 30/λ¶„ | ν•™κµ μ¶•μ  ν™κ²½ (7λ€ Γ— 2λ¶„ = 3.5ν/λ¶„, μ—¬μ  8.5λ°°) |
| GET /api/rankings | 60/λ¶„ | μ΅°νλ” μμ£Ό λ°μƒν•λ―€λ΅ λ” λ§μ΄ ν—μ© |

### λ°μ΄ν„° μ €μ¥
- **λ©”λ¨λ¦¬**: Map<string, Ranking> (μµλ€ 1,000κ°)
- **νμΌ**: `.data/rankings.json` (Render λ³Όλ¥¨, 1GB)
- **λ™κΈ°ν™”**: λ””λ°”μ΄μ‹± 2μ΄
- **λ³µκµ¬**: μ„λ²„ μ¬μ‹μ‘ μ‹ μλ™ λ΅λ“

### μ…λ ¥ κ²€μ¦
- μ΄λ¦„: 1-10μ (trim ν›„)
- returnRate: -100% ~ 10,000% (isFinite μ²΄ν¬)
- finalValue: 0 ~ 100,000,000,000 (isFinite μ²΄ν¬)

### λ³΄μ•
- DELETE /api/rankings: ν™κ²½ λ³€μ `CLEAR_RANKINGS_KEY` ν•„μ”
- λ¨λ“  API: HTTP 200 λ°ν™ (μ—λ¬ μ‹μ—λ„)

---

## π“ ν…μ¤νΈ κ²°κ³Ό

### λ¶€ν• ν…μ¤νΈ (700κ° λ΄‡ μ‹λ®¬λ μ΄μ…)
- **μ„±κ³µλ¥ **: 100% (700/700)
- **μ΄ μ†μ” μ‹κ°„**: 10.96μ΄
- **μ΄λ‹Ή μ²λ¦¬λ‰**: 63.86κ°/μ΄
- **ν‰κ·  μ‘λ‹µ μ‹κ°„**: ~15ms

### μμƒ μ¶•μ  ν™κ²½
- **λ…ΈνΈλ¶**: 7λ€
- **κ²μ„ μ‹κ°„**: 2λ¶„
- **λ­ν‚Ή μ μ¶**: κ²μ„ μΆ…λ£ ν›„ (μ•½ 2λ¶„ κ°„κ²©)
- **μμƒ λ™μ‹ μ”μ²­**: μµλ€ 7κ°
- **4μ‹κ°„ μ΄ μ”μ²­**: μ•½ 840ν (POST 420 + GET 420)

---

## π›΅οΈ μ•μ •μ„± λ³΄μ¥ λ©”μ»¤λ‹μ¦

### 1. λ™μ‹μ„± μ μ–΄
- **λ°©μ‹**: Promise νλ΅ μμ°¨ μ²λ¦¬
- **ν¨κ³Ό**: Race condition λ°©μ§€, λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥

### 2. λ©”λ¨λ¦¬ κ΄€λ¦¬
- **μµλ€ λ­ν‚Ή**: 1,000κ°
- **μλ™ μ •λ¦¬**: μμµλ¥  κΈ°μ¤€ μƒμ„ 1,000κ°λ§ μ μ§€
- **ν¨κ³Ό**: μ¥κΈ° μ΄μ μ‹ λ©”λ¨λ¦¬ λ„μ λ°©μ§€

### 3. νμΌ I/O μµμ ν™”
- **λ””λ°”μ΄μ‹±**: λ§μ§€λ§‰ μ”μ²­ ν›„ 2μ΄ ν›„μ—λ§ μ €μ¥
- **λΉ„λ™κΈ° μ €μ¥**: μ €μ¥ μ‹¤ν¨ν•΄λ„ λ©”λ¨λ¦¬ λ°μ΄ν„° μ μ§€
- **ν¨κ³Ό**: νμΌ I/O λ¶€ν• 95% κ°μ†

### 4. μ—λ¬ λ³µκµ¬
- **λ¨λ“  API**: try-catchλ΅ μ—λ¬ μ²λ¦¬
- **HTTP μ‘λ‹µ**: ν•­μƒ 200 λ°ν™ (μ—λ¬ μ‹μ—λ„)
- **ν¨κ³Ό**: μ„λ²„ ν¬λμ‹ λ°©μ§€, Render μ¬μ‹μ‘ λ°©μ§€

---

## β οΈ μ•λ ¤μ§„ μ μ•½μ‚¬ν•­

### 1. λ‹¨μΌ μΈμ¤ν„΄μ¤
- **μ μ•½**: μν‰ ν™•μ¥ λ¶κ°€λ¥ (λ©”λ¨λ¦¬ κ³µμ  λ¶κ°€)
- **ν„μ¬ μƒνƒ**: Render λ¬΄λ£ ν”λ (λ‹¨μΌ μΈμ¤ν„΄μ¤)
- **μν–¥**: ν•™κµ μ¶•μ  ν™κ²½μ—μ„λ” λ¬Έμ  μ—†μ

### 2. νμΌ μ‹μ¤ν… μμ΅΄μ„±
- **μ μ•½**: Render λ³Όλ¥¨ λ§μ΄νΈ ν•„μ”
- **ν„μ¬ μƒνƒ**: `.data/` λ””λ ‰ν† λ¦¬μ— μ €μ¥ (1GB λ³Όλ¥¨)
- **μν–¥**: μ •μƒ μ‘λ™ μ¤‘

### 3. λ™μ‹μ„± μ μ–΄
- **μ μ•½**: Promise νλ΅ μμ°¨ μ²λ¦¬ (λ™μ‹ μ²λ¦¬ λ¶κ°€)
- **ν„μ¬ μƒνƒ**: λ°μ΄ν„° μΌκ΄€μ„± μ°μ„ 
- **μν–¥**: ν•™κµ μ¶•μ  ν™κ²½μ—μ„λ” λ¬Έμ  μ—†μ

---

## π“ ν™κ²½ λ³€μ μ„¤μ •

### ν•„μ ν™κ²½ λ³€μ
- `NODE_ENV`: `production` (ν”„λ΅λ•μ… λ¨λ“)
- `PORT`: `5000` (κΈ°λ³Έκ°’)

### μ„ νƒμ  ν™κ²½ λ³€μ
- `CLEAR_RANKINGS_KEY`: λ­ν‚Ή μ΄κΈ°ν™” ν‚¤ (κΈ°λ³Έκ°’: `"default-secret-key-change-in-production"`)
- `DISABLE_RATE_LIMIT`: Rate limiting λΉ„ν™μ„±ν™” (κ°λ°μ©, κΈ°λ³Έκ°’: `false`)

---

## π― μ¶•μ  μ΄μ μ²΄ν¬λ¦¬μ¤νΈ

### λ°°ν¬ μ „ ν™•μΈμ‚¬ν•­
- [ ] `CLEAR_RANKINGS_KEY` ν™κ²½ λ³€μ μ„¤μ • (Render λ€μ‹λ³΄λ“)
- [ ] Render λ³Όλ¥¨ λ§μ΄νΈ ν™•μΈ (1GB)
- [ ] Rate Limiting ν™μ„±ν™” ν™•μΈ (ν”„λ΅λ•μ… λ¨λ“)
- [ ] νμΌ μ €μ¥ κ²½λ΅ ν™•μΈ (`.data/rankings.json`)

### μ΄μ μ¤‘ λ¨λ‹ν„°λ§
- [ ] μ„λ²„ λ΅κ·Έ ν™•μΈ (Render λ€μ‹λ³΄λ“)
- [ ] λ­ν‚Ή λ°μ΄ν„° ν™•μΈ (GET /api/rankings)
- [ ] Rate Limiting λ™μ‘ ν™•μΈ
- [ ] λ©”λ¨λ¦¬ μ‚¬μ©λ‰ ν™•μΈ (μµλ€ 1,000κ° λ­ν‚Ή)

### λ¬Έμ  λ°μƒ μ‹ λ€μ‘
1. **μ„λ²„ μ¬μ‹μ‘**: λ­ν‚Ή λ°μ΄ν„°λ” νμΌμ—μ„ μλ™ λ³µκµ¬
2. **Rate Limiting**: μΌμ‹μ μΌλ΅ `DISABLE_RATE_LIMIT=true` μ„¤μ • κ°€λ¥
3. **λ­ν‚Ή μ΄κΈ°ν™”**: `DELETE /api/rankings?key={CLEAR_RANKINGS_KEY}` μ‚¬μ©

---

## π“ μ„±λ¥ μ§€ν‘

### ν„μ¬ μ²λ¦¬ λ¥λ ¥
- **λ™μ‹ μ”μ²­**: 50κ° λ°°μΉ μ²λ¦¬ μ„±κ³µ
- **μµλ€ λ­ν‚Ή**: 1,000κ°
- **νμΌ μ €μ¥**: 2μ΄ λ””λ°”μ΄μ‹±
- **μ‘λ‹µ μ‹κ°„**: ν‰κ·  15ms

### μμƒ μ¶•μ  λ¶€ν•
- **μµλ€ λ™μ‹ μ”μ²­**: 7κ° (λ…ΈνΈλ¶ 7λ€)
- **μ‹κ°„λ‹Ή μ”μ²­**: μ•½ 210ν
- **4μ‹κ°„ μ΄ μ”μ²­**: μ•½ 840ν
- **κ²°λ΅ **: ν„μ¬ μ„¤μ •μΌλ΅ μ¶©λ¶„ν μ²λ¦¬ κ°€λ¥

---

## π” μ½”λ“ κµ¬μ΅°

### μ£Όμ” νμΌ
1. **server/routes.ts**: API μ—”λ“ν¬μΈνΈ, Rate limiting, μ…λ ¥ κ²€μ¦
2. **server/storage.ts**: λ°μ΄ν„° μ €μ¥μ†, λ™μ‹μ„± μ μ–΄, νμΌ I/O
3. **server/index.ts**: Express μ•± μ΄κΈ°ν™”
4. **shared/schema.ts**: νƒ€μ… μ •μ (Ranking interface)
5. **client/src/pages/investment-game.tsx**: ν΄λΌμ΄μ–ΈνΈ κ²μ„ λ΅μ§

### ν•µμ‹¬ ν΄λμ¤
- **MemStorage**: λ©”λ¨λ¦¬ κΈ°λ° μ €μ¥μ†
  - `createRanking()`: λ­ν‚Ή μƒμ„± (λ™μ‹μ„± μ μ–΄)
  - `getRankings()`: λ­ν‚Ή μ΅°ν (μ •λ ¬, μ ν•)
  - `clearRankings()`: λ­ν‚Ή μ΄κΈ°ν™” (λ³΄νΈλ¨)

---

## β… μµμΆ… κ²€μ¦ μ‚¬ν•­

### μ¤λ¥ κ²€μ¦
- [x] TypeScript μ»΄νμΌ μ¤λ¥ μ—†μ
- [x] Linter μ¤λ¥ μ—†μ
- [x] νƒ€μ… μ•μ •μ„± ν™•λ³΄ (createdAt: number)

### κΈ°λ¥ κ²€μ¦
- [x] HTTP 500 λ°ν™ μ κ±° μ™„λ£
- [x] DELETE λ³΄νΈ μ¶”κ°€ μ™„λ£
- [x] Rate Limiting μµμ ν™” μ™„λ£
- [x] createdAt μ§λ ¬ν™” μ•μ •ν™” μ™„λ£

### μ„±λ¥ κ²€μ¦
- [x] 700κ° λ΄‡ μ‹λ®¬λ μ΄μ… μ„±κ³µ
- [x] λ©”λ¨λ¦¬ κ΄€λ¦¬ μ •μƒ μ‘λ™
- [x] νμΌ I/O μµμ ν™” μ μ©

---

## π€ λ°°ν¬ μ¤€λΉ„ μ™„λ£

**ν„μ¬ μƒνƒ**: ν•™κµ μ¶•μ  ν™κ²½μ—μ„ μ•μ •μ μΌλ΅ μ΄μ κ°€λ¥  
**μ„λ²„ μ¬μ‹μ‘ μ„ν—**: μµμ†ν™”λ¨ (HTTP 500 μ κ±°, Rate Limiting μµμ ν™”)  
**λ°μ΄ν„° μ†μ‹¤ μ„ν—**: μµμ†ν™”λ¨ (νμΌ μ €μ¥, μλ™ λ³µκµ¬)  
**μ„±λ¥**: μ¶•μ  ν™κ²½ μ”κµ¬μ‚¬ν•­ μ¶©μ΅±

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-12-25  
**μ„λ²„ λ²„μ „**: 1.0.0 (μµμΆ…)  
**λ°°ν¬ URL**: https://tsts-pmof.onrender.com

